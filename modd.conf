# this file configures https://github.com/cortesi/modd which
# reruns tests and the server whenever dependencies change
# run modd in the root folder of the repo to run the server and tests on all changes

docker-compose.dev.yaml .env.development {
    prep: "
        # Updating database in docker
        docker compose -f docker-compose.dev.yaml down db > /dev/null || true
        docker compose -f docker-compose.dev.yaml --env-file .env.development up db -d > /dev/null
    "
}

**/*.go {
    prep: "
        # Executing Tests
        go test ./...
    "
}

**/*.go html-frontend/** {
    daemon: "
        # Run go-drink
        (sleep 3; echo 'a' >> server-start-file) &
        go run ./...
    "
}

server-start-file {
    daemon: "
        # starting / refreshing live preview
        go tool -modfile=tools.mod devd -m http://localhost:8080
    "
}
